# Reference this view as omni_dbt__all_ads_performance
schema_label: ""

schema: omni_dbt
table_name: ALL_ADS_PERFORMANCE

dimensions:
  date:
    sql: '"DATE"'

  platform:
    sql: '"PLATFORM"'

  account:
    sql: '"ACCOUNT"'

  campaign:
    sql: '"CAMPAIGN"'

  ad_group:
    sql: '"AD_GROUP"'

  conversion_name:
    sql: '"CONVERSION_NAME"'

  is_optimization_conversion:
    sql: '"IS_OPTIMIZATION_CONVERSION"'

  spend:
    sql: '"SPEND"'

  impressions:
    sql: '"IMPRESSIONS"'

  clicks:
    sql: '"CLICKS"'

  conversions:
    sql: '"CONVERSIONS"'

  conversion_value:
    sql: '"CONVERSION_VALUE"'

measures:
  count:
    aggregate_type: count

#The info below was pulled from your dbt repository and is read-only.
dbt:
  name: all_ads_performance
  target_schema: PROD
  config:
    materialized: table
  code: |-
    {{ config(materialized='table') }}

    -- Facebook Ads aggregated to Ad Set level
    SELECT
        date,
        'Facebook' AS platform,
        account,
        campaign,
        adset AS ad_group,
        conversionname AS conversion_name,
        is_optimization_conversion,
        SUM(spend) AS spend,
        SUM(impressions) AS impressions,
        SUM(clicks) AS clicks,
        SUM(allconv) AS conversions,
        NULL AS conversion_value
    FROM {{ ref('facebook_ads_performance') }}
    GROUP BY 1, 2, 3, 4, 5, 6, 7

    UNION ALL

    -- Google Ads at Campaign level with conversion detail
    SELECT
        date,
        'Google' AS platform,
        account,
        campaign,
        NULL AS ad_group,
        conversion_action_name AS conversion_name,
        is_optimization_conversion,
        SUM(spend) AS spend,
        SUM(impressions) AS impressions,
        SUM(clicks) AS clicks,
        SUM(conversions) AS conversions,
        SUM(conversion_value) AS conversion_value
    FROM {{ ref('google_ads_campaign_performance') }}
    GROUP BY 1, 2, 3, 4, 5, 6, 7

    ORDER BY 1 DESC
