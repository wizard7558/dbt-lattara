# Reference this view as dbt_prod__int_google_campaign_conversions
catalog: DBT
schema: PROD
table_name: INT_GOOGLE_CAMPAIGN_CONVERSIONS

dimensions:
  date:
    sql: '"DATE"'

  account:
    sql: '"ACCOUNT"'

  customer_id:
    sql: '"CUSTOMER_ID"'
    format: ID

  campaign:
    sql: '"CAMPAIGN"'

  campaign_id:
    sql: '"CAMPAIGN_ID"'
    format: ID

  conversion_action_name:
    sql: '"CONVERSION_ACTION_NAME"'

  conversions:
    sql: '"CONVERSIONS"'

  conversion_value:
    sql: '"CONVERSION_VALUE"'

measures:
  count:
    aggregate_type: count

#The info below was pulled from your dbt repository and is read-only.
dbt:
  name: int_google_campaign_conversions
  target_schema: PROD
  config:
    materialized: view
  code: |-
    -- int_google_campaign_conversions.sql
    -- Campaign-level conversions by conversion action
    -- Grain: date + campaign + conversion_action_name

    SELECT 
        cc.date,
        acc.account_name AS account,
        cc.customer_id,
        cam.campaign_name AS campaign,
        cc.id AS campaign_id,
        cc.conversion_action_name,
        SUM(cc.all_conversions) AS conversions,
        SUM(cc.all_conversions_value) AS conversion_value
    FROM FIVETRAN_DATABASE.GOOGLE_ADS_FM.CAMPAIGN_CONVERSIONS cc
    LEFT JOIN {{ ref('v_stg_google_accounts') }} acc
        ON acc.customer_id = cc.customer_id
    LEFT JOIN {{ ref('v_stg_google_campaigns') }} cam
        ON cam.campaign_id = cc.id
    GROUP BY 1, 2, 3, 4, 5, 6
    ORDER BY 1 DESC
  referenced_by: [ google_ads_campaign_performance ]
